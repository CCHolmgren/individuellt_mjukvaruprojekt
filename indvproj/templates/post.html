{% extends "layout.html" %}
{% block body %}
    {% from '_formhelpers.html' import render_post_with_delete, render_post_without_delete, render_field, render_post, render_comment, render_childcomments with context %}
    <h1>Post - {{ post.title or "There isn't anything here" }}</h1>
    {% if post %}
        {% if allowed_to_remove %}
            <form method="post" action="/collection/test">
                {{ form.csrf_token() }}
                <select name="collectionid">
                    {% for collection in g.user.collections %}
                        <option value={{ collection.collectionid }}>{{ collection.collectionid }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" value={{ post.postid }} name="postid">
                <input type=submit value=Submit>
            </form>
            {{ render_post(post) }}
            <form method=post action=/p/{{ post.postid }}/delete>
                {{ render_field(form.submit) }}
                {{ form.csrf_token() }}
            </form>
        {% else %}
            {{ render_post_without_delete(post) }}
        {% endif %}
        <form method=post action=/p/{{ post.postid }}/comment>
            {{ render_field(commentform.content) }}
            {{ commentform.csrf_token() }}
            <input type="submit" value="Submit comment">
        </form>
        {% for comment in post.comments.all() %}
            <div>{{ render_comment(comment, post.postid) }}</div>
        {% endfor %}
    {% endif %}
{% endblock %}